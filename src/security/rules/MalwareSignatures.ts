export interface SignatureCheckResult {
  matched: boolean;
  signature?: string;
}

interface MalwareSignature {
  id: string;
  pattern: RegExp;
}

// Keep this list intentionally small and focused on high-confidence matches.
export const DEFAULT_MALWARE_SIGNATURES: readonly MalwareSignature[] = [
  // EICAR test file string (commonly used for safe verification of AV/signature pipelines)
  {
    id: 'eicar',
    pattern:
      /X5O!P%@AP\[4\\PZX54\(P\^\)7CC\)7\}\$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!\$H\+H\*/i
  },

  // PE executable payloads embedded as base64 often start with "TVqQ..." (MZ header)
  { id: 'pe-base64-header', pattern: /\bTVqQAAMAAAAEAAAA\b/ },

  // Common reverse-shell marker
  { id: 'dev-tcp-reverse-shell', pattern: /\/dev\/tcp\/\d{1,3}(?:\.\d{1,3}){3}\/\d{2,5}/ }
];

export function checkSignature(
  content: string,
  signatures: readonly MalwareSignature[] = DEFAULT_MALWARE_SIGNATURES
): SignatureCheckResult {
  const input = content;
  if (!input) return { matched: false };

  for (const sig of signatures) {
    if (sig.pattern.test(input)) {
      return { matched: true, signature: sig.id };
    }
  }

  return { matched: false };
}
